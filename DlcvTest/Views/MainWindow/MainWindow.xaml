<Window x:Class="DlcvTest.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DlcvTest"
        xmlns:wpfv="clr-namespace:DlcvTest.WPFViewer"
        xmlns:controls="clr-namespace:DlcvTest.Controls"
        mc:Ignorable="d"
        Title="AI 测试平台" Height="900" Width="1600" MinHeight="800" MinWidth="1300"
        Closing="Window_Closing"
        Background="Transparent" 
        WindowStyle="None"
        AllowsTransparency="True"
        WindowStartupLocation="CenterScreen"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:ProgressToWidthConverter x:Key="ProgressToWidthConverter"/>
        <!-- 颜色资源 -->
        <SolidColorBrush x:Key="LightGrayBg" Color="#F5F6F8"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="TextGray" Color="#666666"/>
        <SolidColorBrush x:Key="BatchProgressBaseBrush" Color="#667B4DFF"/>
        <DrawingBrush x:Key="BatchProgressStripeBrush" x:Shared="False"
                      TileMode="Tile" Viewport="0,0,16,16" ViewportUnits="Absolute"
                      Stretch="None">
            <DrawingBrush.Transform>
                <TranslateTransform X="0" Y="0"/>
            </DrawingBrush.Transform>
            <DrawingBrush.Drawing>
                <GeometryDrawing Brush="Transparent">
                    <GeometryDrawing.Pen>
                        <Pen Brush="#40FFFFFF" Thickness="4"/>
                    </GeometryDrawing.Pen>
                    <GeometryDrawing.Geometry>
                        <GeometryGroup>
                            <LineGeometry StartPoint="-8,16" EndPoint="16,-8"/>
                            <LineGeometry StartPoint="0,24" EndPoint="24,0"/>
                        </GeometryGroup>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingBrush.Drawing>
        </DrawingBrush>

        <!-- 窗口控制按钮样式（线条形状） -->
        <Style x:Key="WindowControlButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#878896"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#a8aabd"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="WindowMinimizeButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" Background="{TemplateBinding Background}">
                            <Line X1="16" Y1="20" X2="30" Y2="20"
                                  Stroke="{TemplateBinding Foreground}" StrokeThickness="2"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#a8aabd"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="WindowMaximizeButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" Background="{TemplateBinding Background}">
                            <Canvas Width="{TemplateBinding Width}" Height="{TemplateBinding Height}">
                                <Rectangle Width="14" Height="14"
                                           Canvas.Left="16" Canvas.Top="13"
                                           Stroke="{TemplateBinding Foreground}"
                                           StrokeThickness="2"
                                           Fill="Transparent"/>
                            </Canvas>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#a8aabd"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="WindowCloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" Background="{TemplateBinding Background}">
                            <Canvas Width="{TemplateBinding Width}" Height="{TemplateBinding Height}">
                                <Line X1="16" Y1="13" X2="30" Y2="27"
                                      Stroke="{TemplateBinding Foreground}" StrokeThickness="2"/>
                                <Line X1="30" Y1="13" X2="16" Y2="27"
                                      Stroke="{TemplateBinding Foreground}" StrokeThickness="2"/>
                            </Canvas>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#a8aabd"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 批量预测按钮进度填充样式 -->
        <Style x:Key="BatchProgressButtonStyle" TargetType="Button" BasedOn="{StaticResource PurpleButtonStyle}">
            <Setter Property="Background" Value="{StaticResource PrimaryPurple}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                SnapsToDevicePixels="True"
                                ClipToBounds="True">
                            <Grid>
                                <Border x:Name="FillLayer"
                                        Background="{StaticResource PrimaryPurple}"
                                        HorizontalAlignment="Left"
                                        CornerRadius="4">
                                    <Border.Width>
                                        <MultiBinding Converter="{StaticResource ProgressToWidthConverter}">
                                            <Binding ElementName="Root" Path="ActualWidth"/>
                                            <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="BatchProgressVisualValue"/>
                                        </MultiBinding>
                                    </Border.Width>
                                </Border>
                                <Border x:Name="StripeLayer"
                                        Background="{StaticResource BatchProgressStripeBrush}"
                                        HorizontalAlignment="Left"
                                        Opacity="0"
                                        CornerRadius="4">
                                    <Border.Width>
                                        <MultiBinding Converter="{StaticResource ProgressToWidthConverter}">
                                            <Binding ElementName="Root" Path="ActualWidth"/>
                                            <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="BatchProgressVisualValue"/>
                                        </MultiBinding>
                                    </Border.Width>
                                </Border>
                                <ContentPresenter HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  Margin="{TemplateBinding Padding}"
                                                  RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsBatchRunning, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                <Setter TargetName="StripeLayer" Property="Opacity" Value="0.35"/>
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard x:Name="StripeStoryboard">
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation Storyboard.TargetName="StripeLayer"
                                                             Storyboard.TargetProperty="(Border.Background).(DrawingBrush.Transform).(TranslateTransform.X)"
                                                             From="0" To="16" Duration="0:0:1"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <StopStoryboard BeginStoryboardName="StripeStoryboard"/>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsBatchRunning, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                    <Setter Property="IsEnabled" Value="False"/>
                    <Setter Property="Background" Value="{StaticResource BatchProgressBaseBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- 批量预测取消按钮样式（圆形灰色背景，hover变红变大） -->
        <Style x:Key="BatchCancelButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="#999"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="14"
                                SnapsToDevicePixels="True">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="1" BlurRadius="3" Opacity="0.3" Color="Black"/>
                            </Border.Effect>
                            <Canvas Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Line X1="0" Y1="0" X2="10" Y2="10" 
                                      Stroke="White" StrokeThickness="2" 
                                      StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                <Line X1="10" Y1="0" X2="0" Y2="10" 
                                      Stroke="White" StrokeThickness="2"
                                      StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Canvas>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#d1282a"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect ShadowDepth="1" BlurRadius="5" Opacity="0.5" Color="#d1282a"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.15" ScaleY="1.15"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#b02020"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.1" ScaleY="1.1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 1. 顶部菜单按钮样式 (无背景，鼠标悬停变色) -->
        <Style x:Key="MenuButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="10,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource PrimaryPurple}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 3. 右侧 Tab 切换样式 (胶囊风格) -->
        <Style x:Key="TabRadioButtonStyle" TargetType="RadioButton">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Margin="2" SnapsToDevicePixels="True">
                            <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="4"/>
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              RecognizesAccessKey="True"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="White"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryPurple}"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect ShadowDepth="0" BlurRadius="4" Opacity="0.1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 4. 步进器按钮样式 -->
        <Style x:Key="StepperButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F0F0F0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 5. 透明棋盘格背景(DrawingBrush) -->
        <DrawingBrush x:Key="CheckerboardBrush" TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute">
            <DrawingBrush.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="White">
                        <GeometryDrawing.Geometry>
                            <RectangleGeometry Rect="0,0,20,20"/>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                    <GeometryDrawing Brush="#F0F0F0">
                        <GeometryDrawing.Geometry>
                            <GeometryGroup>
                                <RectangleGeometry Rect="0,0,10,10"/>
                                <RectangleGeometry Rect="10,10,10,10"/>
                            </GeometryGroup>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingGroup>
            </DrawingBrush.Drawing>
        </DrawingBrush>

        <!-- 6. Expander 样式 - 带√符号 -->
        <Style TargetType="Expander">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="√" FontSize="16" Foreground="{StaticResource PrimaryPurple}" FontWeight="Bold" Margin="0,0,5,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding}" FontSize="15" Foreground="#333" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TreeView 选中/悬停颜色 -->
        <SolidColorBrush x:Key="TreeViewItemSelectedBrush" Color="#8036C26A"/>
        <SolidColorBrush x:Key="TreeViewItemHoverBrush" Color="#3336C26A"/>

        <!-- TreeViewItem 样式美化（整行圆角高亮） -->
        <ControlTemplate x:Key="TreeViewExpanderToggleTemplate" TargetType="ToggleButton">
            <Grid Width="12" Height="12" Background="Transparent">
                <Path x:Name="Arrow"
                      Data="M 0 0 L 0 8 L 6 4 Z"
                      Fill="#666"
                      Stretch="Uniform"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      RenderTransformOrigin="0.5,0.5"/>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter TargetName="Arrow" Property="RenderTransform">
                        <Setter.Value>
                            <RotateTransform Angle="90"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Arrow" Property="Fill" Value="#333"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter TargetName="Arrow" Property="Fill" Value="#999"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style TargetType="TreeViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TreeViewItem">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border x:Name="RowBackground"
                                    Grid.ColumnSpan="2"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="6"/>

                            <ToggleButton x:Name="Expander"
                                          Grid.Row="0"
                                          Grid.Column="0"
                                          Width="12"
                                          Height="12"
                                          Margin="6,0,6,0"
                                          VerticalAlignment="Center"
                                          Focusable="False"
                                          IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                          Template="{StaticResource TreeViewExpanderToggleTemplate}"/>

                            <ContentPresenter x:Name="PART_Header"
                                              Grid.Row="0"
                                              Grid.Column="1"
                                              ContentSource="Header"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              Margin="{TemplateBinding Padding}"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

                            <ItemsPresenter x:Name="ItemsHost"
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            Margin="18,2,0,0"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="Expander" Property="Visibility" Value="Hidden"/>
                            </Trigger>
                            <Trigger Property="IsExpanded" Value="False">
                                <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource TreeViewItemHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource TreeViewItemSelectedBrush}"/>
                                <Setter Property="Foreground" Value="#1B6B3B"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter Property="Background" Value="{StaticResource TreeViewItemSelectedBrush}"/>
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#999"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox 样式 -->
        <Style TargetType="ComboBox">
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="8,0"/>
        </Style>

        <!-- TextBox 样式 -->
        <Style TargetType="TextBox">
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>

        <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="20" />
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" 
                        Grid.ColumnSpan="2"
                        CornerRadius="4"
                        Background="Transparent"
                        BorderBrush="Transparent"
                        BorderThickness="0" />
                <Path x:Name="Arrow"
                      Grid.Column="1"     
                      Fill="#999"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Data="M0,0 L8,0 L4,4 z" />
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter TargetName="Arrow" Property="RenderTransform">
                        <Setter.Value>
                            <RotateTransform Angle="180" CenterX="4" CenterY="2"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <ControlTemplate x:Key="ComboBoxTextBox" TargetType="TextBox">
            <Border x:Name="PART_ContentHost" Focusable="False" Background="{TemplateBinding Background}" />
        </ControlTemplate>

        <!-- IOS 风格 ComboBox 样式 -->
        <Style x:Key="IOSComboBoxStyle" TargetType="ComboBox">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="MinHeight" Value="20"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton" 
                                          Template="{StaticResource ComboBoxToggleButton}" 
                                          Grid.Column="2" 
                                          Focusable="false"
                                          IsChecked="{Binding Path=IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"/>
                            <ContentPresenter Name="ContentSite" IsHitTestVisible="False"  Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="10,0,23,0"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left" />
                            <TextBox x:Name="PART_EditableTextBox"
                                     Style="{x:Null}" 
                                     Template="{StaticResource ComboBoxTextBox}" 
                                     HorizontalAlignment="Left" 
                                     VerticalAlignment="Center" 
                                     Margin="10,0,23,0"
                                     Focusable="True" 
                                     Background="Transparent"
                                     Visibility="Hidden"
                                     IsReadOnly="{TemplateBinding IsReadOnly}"/>
                            <Popup Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True" 
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#E0E0E0"
                                            CornerRadius="8"
                                            Margin="0,5,0,0">
                                        <Border.Effect>
                                            <DropShadowEffect ShadowDepth="2" BlurRadius="10" Opacity="0.1" Color="Black"/>
                                        </Border.Effect>
                                        <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="false">
                                <Setter TargetName="DropDownBorder" Property="MinHeight" Value="95"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Foreground" Value="#888888"/>
                            </Trigger>
                            <Trigger Property="IsGrouping" Value="true">
                                <Setter Property="ScrollViewer.CanContentScroll" Value="false"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Border Background="White" CornerRadius="8" BorderBrush="#E0E0E0" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/> <!-- 顶部菜单栏 -->
                <RowDefinition Height="60"/> <!-- 数据路径栏 -->
                <RowDefinition Height="*"/>  <!-- 主内容区 -->
            </Grid.RowDefinitions>

            <!-- 遮罩层 - 设置窗口打开时显示 -->
            <Border x:Name="overlayMask" Grid.RowSpan="3" Background="#80000000" Visibility="Collapsed" Panel.ZIndex="1000"
                    MouseLeftButtonDown="OverlayMask_MouseLeftButtonDown"/>

            <!-- 模型加载遮罩层 -->
            <Border x:Name="modelLoadingOverlay" Grid.RowSpan="3" Background="#99000000" 
                    Visibility="Collapsed" Panel.ZIndex="1001">
                <Border.Resources>
                    <!-- 模型加载旋转动画 -->
                    <Storyboard x:Key="SpinnerStoryboard" RepeatBehavior="Forever">
                        <DoubleAnimation Storyboard.TargetName="spinnerRotate"
                                         Storyboard.TargetProperty="Angle"
                                         From="0" To="360" Duration="0:0:1"/>
                    </Storyboard>
                </Border.Resources>
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <!-- 旋转圈圈动画 -->
                    <Ellipse Width="48" Height="48" StrokeThickness="4" 
                             Stroke="#7B4DFF" StrokeDashArray="3 2" RenderTransformOrigin="0.5,0.5">
                        <Ellipse.RenderTransform>
                            <RotateTransform x:Name="spinnerRotate"/>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <!-- 提示文字 -->
                    <TextBlock Text="正在加载模型..." Foreground="White" FontSize="16" 
                               Margin="0,16,0,0" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- Row 0: 顶部菜单栏 -->
            <Grid Grid.Row="0">
                <Border Background="White" CornerRadius="8,8,0,0" BorderBrush="#EEE" BorderThickness="0,0,0,1"/>
                <DockPanel LastChildFill="False" Margin="15,0,0,0">
                    <!-- Logo / 标题 -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,20,0">
                        <Border Background="{StaticResource PrimaryPurple}" CornerRadius="4" Width="20" Height="20" Margin="0,0,8,0">
                            <TextBlock Text="AI" Foreground="White" FontSize="9" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="AI 测试平台" FontSize="14" FontWeight="Bold" VerticalAlignment="Center" Foreground="#333"/>
                    </StackPanel>

                    <!-- 菜单栏 -->
                    <Button Content="文件" Style="{StaticResource MenuButtonStyle}"/>
                    <Button Content="可视化参数" Style="{StaticResource MenuButtonStyle}" Click="btnVisualParams_Click"/>
                    <Button Content="设置(Setting)" Style="{StaticResource MenuButtonStyle}" Click="btnSettings_Click"/>
                    
                    <!-- 右上角窗口控制按钮 -->
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,5,0">
                        <Button Style="{StaticResource WindowMinimizeButtonStyle}" Click="btnMinimize_Click" ToolTip="最小化"/>
                        <Button Style="{StaticResource WindowMaximizeButtonStyle}" Click="btnMaximize_Click" ToolTip="最大化"/>
                        <Button Style="{StaticResource WindowCloseButtonStyle}" Click="btnClose_Click" ToolTip="关闭"/>
                    </StackPanel>
                </DockPanel>
            </Grid>

        <!-- Row 1: 数据路径栏 -->
        <Grid Grid.Row="1" Background="White" Margin="15,0" TextElement.FontSize="14">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="数据路径：" VerticalAlignment="Center" Foreground="#666" FontSize="16" Margin="0,0,10,0"/>
            
            <!-- 路径输入框 -->
            <Border Grid.Column="1" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="36" VerticalAlignment="Center">
                <TextBox x:Name="txtDataPath" Text="请打开数据文件夹……" 
                         BorderThickness="0" Background="Transparent" VerticalContentAlignment="Center" Padding="10,0" Foreground="#333" IsReadOnly="True"/>
            </Border>

            <!-- 选择文件夹按钮 -->
            <Button Grid.Column="2" Content="选择文件夹" Click="btnSelectFolder_Click" Style="{StaticResource PurpleButtonStyle}" Margin="10,0,0,0" Height="36" VerticalAlignment="Center" FontSize="16"/>
        </Grid>

        <!-- Row 2: 主内容区 (三列布局，含可拖拽分隔条) -->
        <Grid Grid.Row="2" Margin="15,0,15,15" TextElement.FontSize="14">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260" MinWidth="200"/> <!-- 左侧列表 -->
                <ColumnDefinition Width="6"/>                  <!-- 分隔条1 -->
                <ColumnDefinition Width="*" MinWidth="400"/>   <!-- 中间预览 -->
                <ColumnDefinition Width="6"/>                  <!-- 分隔条2 -->
                <ColumnDefinition Width="320" MinWidth="240"/> <!-- 右侧属性栏 -->
            </Grid.ColumnDefinitions>

            <!-- Column 0: 左侧文件列表 -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 搜索框 -->
                <Border Grid.Row="0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="32" Margin="0,0,0,10">
                    <Grid>
                        <TextBox x:Name="txtFolderSearch" BorderThickness="0" Background="Transparent" 
                                 VerticalContentAlignment="Center" Padding="8,0" 
                                 Tag="搜索文件/文件夹" KeyDown="txtFolderSearch_KeyDown"/>
                        <TextBlock Text="搜索文件/文件夹" Foreground="#999" VerticalAlignment="Center" Margin="10,0,0,0" IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Text, ElementName=txtFolderSearch}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Border>

                <!-- 图片数量 -->
                <TextBlock Grid.Row="1" x:Name="txtFolderImageCount" Text="{Binding FolderImageCount, StringFormat=图片数量: {0}}" Foreground="#666" FontSize="14" Margin="0,0,0,5"/>

                <!-- 树形列表 -->
                <Border Grid.Row="2" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Background="White">
                    <TreeView x:Name="tvFolders" BorderThickness="0" Background="Transparent" SelectedItemChanged="tvFolders_SelectedItemChanged">
                        <TreeView.Resources>
                            <!-- 左侧树形列表：仅显示滑块，隐藏轨道 -->
                            <Style TargetType="{x:Type ScrollBar}">
                                <Setter Property="Width" Value="6"/>
                                <Setter Property="MinWidth" Value="6"/>
                                <Setter Property="Template" Value="{StaticResource ThumbOnlyVerticalScrollBarTemplate}"/>
                                <Style.Triggers>
                                    <Trigger Property="Orientation" Value="Horizontal">
                                        <Setter Property="Height" Value="6"/>
                                        <Setter Property="MinHeight" Value="6"/>
                                        <Setter Property="Width" Value="Auto"/>
                                        <Setter Property="Template" Value="{StaticResource ThumbOnlyHorizontalScrollBarTemplate}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>

                            <HierarchicalDataTemplate DataType="{x:Type local:FileNode}" ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal">
                                    <Viewbox Width="12" Height="12" Margin="0,1,6,0">
                                        <!-- Default is Folder (Gray/White controlled by triggers) -->
                                        <Path x:Name="IconPath" Fill="#666" Stretch="Uniform"
                                              Data="M4,4c-1.1,0-2,0.9-2,2v12c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V8c0-1.1-0.9-2-2-2h-8l-2-2H4z" />
                                    </Viewbox>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center" />
                                </StackPanel>
                                <HierarchicalDataTemplate.Triggers>
                                    <!-- File Icon Trigger -->
                                    <DataTrigger Binding="{Binding IsDirectory}" Value="False">
                                        <Setter TargetName="IconPath" Property="Data" 
                                                Value="M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M14,9V3.5L18.5,8H14z"/>
                                        <Setter TargetName="IconPath" Property="Fill" Value="White"/>
                                        <Setter TargetName="IconPath" Property="Stroke" Value="#666"/>
                                        <Setter TargetName="IconPath" Property="StrokeThickness" Value="1"/>
                                    </DataTrigger>
                                    
                                    <!-- Folder Expanded Trigger -->
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding IsDirectory}" Value="True"/>
                                            <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=TreeViewItem}, Path=IsExpanded}" Value="True"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter TargetName="IconPath" Property="Fill" Value="White"/>
                                        <Setter TargetName="IconPath" Property="Stroke" Value="#666"/>
                                        <Setter TargetName="IconPath" Property="StrokeThickness" Value="1"/>
                                    </MultiDataTrigger>
                                </HierarchicalDataTemplate.Triggers>
                            </HierarchicalDataTemplate>
                        </TreeView.Resources>
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                </Border>
            </Grid>

            <!-- Column 1: 分隔条1 -->
            <GridSplitter Grid.Column="1"
                          Width="6"
                          Background="Transparent"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns"
                          ShowsPreview="False"
                          Cursor="SizeWE"/>

            <!-- Column 2: 中间预览区 -->
            <Border Grid.Column="2" Background="{StaticResource CheckerboardBrush}" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" ClipToBounds="True">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="1"/> <!-- 分割线 -->
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 预览 1 - 使用Border限制边界，防止超出分割线 -->
                    <Border Grid.Column="0" x:Name="border1" ClipToBounds="True" Background="Transparent">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <wpfv:WpfImageViewer x:Name="wpfViewer1"
                                                 Grid.Row="0" Grid.Column="0"
                                                 HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                        </Grid>
                    </Border>
                    
                    <!-- 分割线 -->
                    <Rectangle Grid.Column="1" x:Name="dividerLine" Fill="#999" Panel.ZIndex="10"/>

                    <!-- 预览 2 - 使用Border限制边界，防止超出分割线 -->
                    <Border Grid.Column="2" x:Name="border2" ClipToBounds="True" Background="Transparent">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <wpfv:WpfImageViewer x:Name="wpfViewer2"
                                                 Grid.Row="0" Grid.Column="0"
                                                 HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Column 3: 分隔条2 -->
            <GridSplitter Grid.Column="3"
                          Width="6"
                          Background="Transparent"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns"
                          ShowsPreview="False"
                          Cursor="SizeWE"/>

            <!-- Column 4: 右侧属性栏 -->
            <Grid Grid.Column="4" Background="White">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Tabs -->
                    <RowDefinition Height="*"/>    <!-- Content -->
                    <RowDefinition Height="Auto"/> <!-- Bottom Button -->
                </Grid.RowDefinitions>

                <!-- 1. Tabs (灰色背景) -->
                <Border Grid.Row="0" Height="35" Background="{StaticResource LightGrayBg}" CornerRadius="4" Padding="2" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <RadioButton Content="标准" IsChecked="True" Style="{StaticResource TabRadioButtonStyle}"/>
                        <RadioButton Content="流程模块化" Grid.Column="1" Style="{StaticResource TabRadioButtonStyle}"/>
                    </Grid>
                </Border>

                <!-- 2. Scrollable Content -->
                <ScrollViewer Grid.Row="1" FocusVisualStyle="{x:Null}" VerticalScrollBarVisibility="Auto" Margin="0,0,-10,0" Padding="0,0,10,0">
                    <StackPanel>
                        
                        <!-- 模型信息 -->
                        <ToggleButton x:Name="btnModelInfoGroup" IsChecked="True" Content="模型信息" Style="{StaticResource GroupToggleButtonStyle}" Margin="0,0,0,5"/>
                        <StackPanel Margin="10,5,0,0" Visibility="{Binding IsChecked, ElementName=btnModelInfoGroup, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <DockPanel LastChildFill="True">
                                    <TextBlock Text="模型名称" VerticalAlignment="Center" Margin="0,0,10,0"     Foreground="#666"/>
                                    <!-- Folder Button -->
                                    <Button x:Name="btnSelectModel" FocusVisualStyle="{x:Null}" DockPanel.Dock="Right" Width="32" Height="32" Margin="5,0,0,0" Background="White" BorderBrush="#E0E0E0" BorderThickness="1" Click="btnSelectModel_Click" Cursor="Hand">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                                                    <Path Data="M2,4 L6,4 L8,6 L18,6 L18,14 L2,14 Z" Stroke="#666" StrokeThickness="1" Fill="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                    <!-- ComboBox -->
                                    <Border BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="32" Background="White">
                                        <ComboBox x:Name="cmbModelName"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  VerticalContentAlignment="Center"
                                                  IsEditable="False"
                                                  IsReadOnly="True"
                                                  Padding="10,0"
                                                  Style="{StaticResource IOSComboBoxStyle}"
                                                  SelectionChanged="cmbModelName_SelectionChanged">
                                            <ComboBox.ItemContainerStyle>
                                                <Style TargetType="ComboBoxItem">
                                                    <!-- 显示完整路径，便于用户确认 -->
                                                    <Setter Property="ToolTip" Value="{Binding ModelPath}"/>
                                                    <Style.Triggers>
                                                        <!-- 占位项仅用于未加载时显示，不出现在下拉列表中 -->
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding IsPlaceholder}" Value="True"/>
                                                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=ComboBox}, Path=IsDropDownOpen}" Value="True"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </MultiDataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ComboBox.ItemContainerStyle>
                                        </ComboBox>
                                    </Border>
                                </DockPanel>
                            </StackPanel>

                        <!-- 预测参数 -->
                        <ToggleButton x:Name="btnPredictParamsGroup" IsChecked="True" Content="预测参数" Style="{StaticResource GroupToggleButtonStyle}" Margin="0,15,0,5"/>
                        <StackPanel Grid.IsSharedSizeScope="True" Margin="10,5,0,0" Visibility="{Binding IsChecked, ElementName=btnPredictParamsGroup, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <!-- 置信度 -->
                                <Grid x:Name="gridConfidence" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ParamLabelColumn"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="置信度" VerticalAlignment="Center" Foreground="#666" HorizontalAlignment="Left"/>
                                    <Border Grid.Column="1" HorizontalAlignment="Left" Margin="16,0,0,0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="32" Width="120" Background="White">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Button Content="-" Style="{StaticResource StepperButtonStyle}" Grid.Column="0" Click="Stepper0_1Button_Click"/>
                                            <Rectangle Width="1" Fill="#E0E0E0" Grid.Column="0" HorizontalAlignment="Right"/>
                                            <TextBox x:Name="ConfidenceVal" Text="0.50" Grid.Column="1" BorderThickness="0" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Foreground="#333" LostFocus="ParameterTextBox_LostFocus" TextChanged="ParameterTextBox_TextChanged"/>
                                            <Rectangle Width="1" Fill="#E0E0E0" Grid.Column="2" HorizontalAlignment="Left"/>
                                            <Button Content="+" Style="{StaticResource StepperButtonStyle}" Grid.Column="2" Click="Stepper0_1Button_Click"/>
                                        </Grid>
                                    </Border>
                                </Grid>

                                <!-- top_k (仅图像分类显示) -->
                                <Grid x:Name="gridTopK" Margin="0,0,0,12" Visibility="Collapsed">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ParamLabelColumn"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="top_k" VerticalAlignment="Center" Foreground="#666" HorizontalAlignment="Left"/>
                                    <Border Grid.Column="1" HorizontalAlignment="Left" Margin="16,0,0,0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="32" Width="120" Background="White">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Button Content="-" Style="{StaticResource StepperButtonStyle}" Grid.Column="0" Click="StepperIntButton_Click"/>
                                            <Rectangle Width="1" Fill="#E0E0E0" Grid.Column="0" HorizontalAlignment="Right"/>
                                            <TextBox x:Name="TopKVal" Text="1" Grid.Column="1" BorderThickness="0" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Foreground="#333"/>
                                            <Rectangle Width="1" Fill="#E0E0E0" Grid.Column="2" HorizontalAlignment="Left"/>
                                            <Button Content="+" Style="{StaticResource StepperButtonStyle}" Grid.Column="2" Click="StepperIntButton_Click"/>
                                        </Grid>
                                    </Border>
                                </Grid>

                                <!-- 自动标注复杂度 -->
                                <Grid Margin="0,0,0,12" Visibility="Collapsed">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ParamLabelColumn"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="自动标注复杂度" VerticalAlignment="Center" Foreground="#666" HorizontalAlignment="Left"/>
                                    <Border Grid.Column="1" HorizontalAlignment="Left" Margin="16,0,0,0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="32" Width="120" Background="White">
                                        <TextBox x:Name="AutoLabelComplexityVal" Text="1000" BorderThickness="0" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Background="Transparent" Foreground="#333" LostFocus="ParameterTextBox_LostFocus" TextChanged="ParameterTextBox_TextChanged"/>
                                    </Border>
                                </Grid>

                                <!-- 类别屏蔽 -->
                                <Grid x:Name="gridCategoryFilter" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ParamLabelColumn"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="类别屏蔽" VerticalAlignment="Center" Foreground="#666" HorizontalAlignment="Left"/>
                                    <Border Grid.Column="1" HorizontalAlignment="Left" Margin="16,0,0,0" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Height="32" Width="120" Background="White">
                                        <ComboBox Style="{StaticResource IOSComboBoxStyle}" 
                                                  IsEditable="False" IsReadOnly="True" 
                                                  VerticalContentAlignment="Center" 
                                                  BorderThickness="0" Background="Transparent" 
                                                  Padding="10,0">
                                            <ComboBoxItem FocusVisualStyle="{x:Null}" Content="Select" IsSelected="True"/>
                                        </ComboBox>
                                    </Border>
                                </Grid>

                                <!-- 显示mask -->
                                <Grid x:Name="gridShowMask" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ParamLabelColumn"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="显示mask" VerticalAlignment="Center" Foreground="#666" HorizontalAlignment="Left"/>
                                    <controls:AnimatedCheckBox Grid.Column="1" x:Name="chkShowMaskPane" HorizontalAlignment="Left" Margin="16,0,0,0" VerticalAlignment="Center" Checked="chkShowMaskPane_Checked" Unchecked="chkShowMaskPane_Checked"/>
                                </Grid>

                                <!-- 显示边缘 -->
                                <Grid x:Name="gridShowEdges" Margin="0,0,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="ParamLabelColumn"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="显示边缘" VerticalAlignment="Center" Foreground="#666" HorizontalAlignment="Left"/>
                                    <controls:AnimatedCheckBox Grid.Column="1" x:Name="chkShowEdgesPane" HorizontalAlignment="Left" Margin="16,0,0,0" VerticalAlignment="Center" Checked="chkShowEdgesPane_Checked" Unchecked="chkShowEdgesPane_Checked"/>
                                </Grid>
                            </StackPanel>

                        <!-- 预测结果 -->
                        <ToggleButton x:Name="btnPredictResultGroup" IsChecked="True" Content="预测结果" Style="{StaticResource GroupToggleButtonStyle}" Margin="0,15,0,5"/>
                        <StackPanel Visibility="{Binding IsChecked, ElementName=btnPredictResultGroup, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock x:Name="txtPredictResultEmpty" Text="暂无结果" Foreground="#999" Margin="10,5"/>
                            <ItemsControl x:Name="PredictResultList" Margin="10,0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" Foreground="#666" Margin="0,2"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>

                <!-- 3. Bottom Section -->
                <Grid Grid.Row="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 批量预测按钮区域：进度按钮 + 取消按钮 -->
                    <Grid Grid.Row="0" Height="40" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 进度按钮 -->
                        <Button x:Name="btnInferBatchJson"
                                Grid.Column="0"
                                Click="btnInferBatchJson_Click"
                                Content="{Binding BatchProgressText, RelativeSource={RelativeSource AncestorType=Window}}"
                                Style="{StaticResource BatchProgressButtonStyle}"/>
                        
                        <!-- 取消按钮（批量运行时显示） -->
                        <Button x:Name="btnCancelBatch"
                                Grid.Column="1"
                                Width="28" Height="28"
                                Margin="8,0,0,0"
                                Click="btnCancelBatch_Click"
                                Style="{StaticResource BatchCancelButtonStyle}"
                                Visibility="{Binding IsBatchRunning, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </Grid>
                    
                </Grid>
            </Grid>
        </Grid>
    </Grid>
    </Border>
</Window>
